# BUG 修复 Skill

## 目标

帮助用户定位并修复 BUG，生成详细的修复报告。

---

## 执行流程

### Step 0: 状态恢复（必须执行）

#### 0.1 读取进度文件

读取 `.output/progress.md`，了解当前项目状态。如果不存在则跳过（可能是独立项目）。

#### 0.2 输出当前状态摘要

```
【状态恢复】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 项目进度：
   - 已完成页面：01-登录页 ✅, 02-首页 ✅
   - 进行中：03-详情页（前端 ✅, 接口 ✅, 后端 🔄）

📁 项目结构：
   - 前端：frontend/src/views/, frontend/src/api/
   - 后端：backend/src/api/routes/, backend/src/services/

📡 相关接口：
   - POST /api/auth/login
   - GET /api/items
   - GET /api/items/:id
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

---

### Step 1: 记录用户原话

**完整保存用户描述的问题**，不做任何修改：

```markdown
## 用户原话

> [完整复制用户输入的问题描述，包括错误信息、截图描述等]
```

---

### Step 2: 问题分析

将用户描述翻译成技术语言，提取关键信息：

#### 2.1 提取关键信息

| 项目 | 内容 |
|------|------|
| **现象** | 用户看到了什么？（页面表现、错误提示） |
| **触发条件** | 什么情况下出现？（操作步骤、特定数据） |
| **错误信息** | 控制台/日志中的具体报错 |
| **影响范围** | 哪些功能受影响？ |

#### 2.2 问题分类

| 类型 | 特征 | 排查方向 |
|------|------|----------|
| **前端 UI** | 样式错乱、显示异常 | CSS、组件模板 |
| **前端逻辑** | 交互无响应、数据不更新 | Vue 组件、事件处理 |
| **API 调用** | 请求失败、数据异常 | 接口地址、参数、Mock |
| **后端接口** | 500 错误、响应异常 | 路由、Service、数据库 |
| **数据库** | 数据丢失、查询错误 | ORM、SQL、连接配置 |
| **配置问题** | 环境变量、依赖缺失 | .env、config、package.json |

#### 2.3 可能原因猜测

根据问题类型，列出 3-5 个可能的原因（按可能性排序）：

```markdown
## 可能原因

1. **[最可能]** xxx
   - 依据：xxx
   - 检查位置：xxx

2. **[较可能]** xxx
   - 依据：xxx
   - 检查位置：xxx

3. **[可能]** xxx
   - 依据：xxx
   - 检查位置：xxx
```

---

### Step 3: 定位 BUG

#### 3.1 检查相关文件

根据问题类型，定位可能出问题的文件：

| 问题类型 | 检查文件 |
|----------|----------|
| 前端页面 | `frontend/src/views/Xxx.vue` |
| 前端 API | `frontend/src/api/xxx.ts` |
| 前端路由 | `frontend/src/router/index.ts` |
| 后端接口 | `backend/src/api/routes/xxx.py` |
| 后端服务 | `backend/src/services/xxx.py` |
| 数据库 | `backend/src/db/models.py`、`session.py` |
| 配置 | `.env`、`config.toml`、`package.json` |

#### 3.2 复现问题

如果可能，尝试复现问题：
1. 按用户描述的步骤操作
2. 观察控制台/日志输出
3. 确认问题确实存在

#### 3.3 定位根本原因

通过代码审查和日志分析，找到 BUG 的根本原因：

```markdown
## 根本原因

**位置**：`frontend/src/api/auth.ts:25`

**原因**：Mock 数据返回的结构与真实 API 不一致，缺少 `data` 包装层

**代码**：
```typescript
// 错误代码
return { access_token: 'xxx' }

// 应该是
return { data: { access_token: 'xxx' } }
```
```

---

### Step 4: 修复 BUG

#### 4.1 实施修复

根据根本原因，修改相关代码。

#### 4.2 验证修复

1. 确认问题不再复现
2. 确认没有引入新问题
3. 检查相关功能是否正常

---

### Step 5: 生成修复报告

创建文件 `.output/bug_fix/YYYYMMDD-HHMMSS-问题简述.md`：

```markdown
# BUG 修复报告

> 修复时间：YYYY-MM-DD HH:MM:SS

---

## 一、用户原话

> [完整复制用户输入的问题描述]

---

## 二、问题分析

### 现象
[描述用户看到的现象]

### 触发条件
[描述什么情况下出现]

### 错误信息
```
[控制台/日志中的错误信息]
```

---

## 三、可能原因猜测

1. **[最可能]** xxx
   - 依据：xxx

2. **[较可能]** xxx
   - 依据：xxx

3. **[可能]** xxx
   - 依据：xxx

---

## 四、根本原因

**位置**：`[文件路径:行号]`

**原因**：[技术描述]

**问题代码**：
```[语言]
[问题代码]
```

---

## 五、解决方案

**修复方式**：[描述修复方法]

**修复代码**：
```[语言]
[修复后的代码]
```

**修改文件列表**：
- `[文件1]`：[修改说明]
- `[文件2]`：[修改说明]

---

## 六、验证结果

- [x] 问题不再复现
- [x] 相关功能正常
- [x] 未引入新问题

---

## 七、经验总结

**教训**：[这次 BUG 的教训是什么]

**预防**：[如何避免类似问题]
```

---

## 产出物清单

- [ ] BUG 已修复
- [ ] `.output/bug_fix/YYYYMMDD-HHMMSS-xxx.md` 已创建
- [ ] 修改的代码已保存

---

## 注意事项

1. **保留原话** - 用户描述必须原样保留，不要改写
2. **先分析后动手** - 不要急于修改代码，先分析清楚原因
3. **最小改动** - 只修复 BUG，不要顺便重构
4. **验证充分** - 确保修复有效且没有副作用
5. **记录详细** - 报告要详细，方便后续查阅
